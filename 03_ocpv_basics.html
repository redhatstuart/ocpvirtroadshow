<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
  <link rel="manifest" href="site.webmanifest">
  <link rel="mask-icon" href="safari-pinned-tab.svg" color="#5bbad5">
  <meta name="msapplication-TileColor" content="#da532c">
  <meta name="theme-color" content="#ffffff">
  <script src="jquery/jquery.min.js"></script>
  <script src="popper/popper.min.js"></script>
  <script src="bootstrap/js/bootstrap.min.js"></script>
  <script src="requirejs/require.js"></script>
  <script>var workshop_base_url = "/workshop";</script>
  
  <link rel="stylesheet" href="asciidoctor/css/asciidoctor.css">
  
  <link rel="stylesheet" href="bootstrap/css/bootstrap.min.css">
  <link rel="stylesheet" href="fontawesome/css/all.min.css">
  <link rel="stylesheet" href="css/workshop.css">
  <link rel="stylesheet" href="css/workshop-asciidoc.css">
  
</head>
</body>
  <!-- Header -->
  <header class="header">
    <div class="container-fluid">
      <div class="row">
        <div class="col-sm-6">
          <a href="index.html" class="logo">Red Hat OpenShift Virtualization Roadshow</a>
        </div>
      </div>
    </div>
  </header>
  <!-- Main -->
  <div class="container-fluid">
    <div class="row">
      <div class="col-sm-3 d-sm-block d-none">
        <!-- Table of Contents -->
        <ul class="menu">
          <li class="category">
            <ul class="modules">
              <h5 class="category-title">Workshop Modules</h5>
              
                
                  <li class="page"><a href="index.html">Welcome</a></li>
                
              
                
                  <li class="page"><a href="02_migrate_vms.html">Migrating Virtual Machines</a></li>
                
              
                
                  <li class="page active"><a href="03_ocpv_basics.html">OpenShift Virtualization Basics</a></li>
                
              
                
                  <li class="page"><a href="04_thanks.html">Thank you and next steps</a></li>
                
              
                
                  <li class="page"><a href="05_ocpv_customization.html">Optional: Customize Virtual Machines</a></li>
                
              
                
                  <li class="page"><a href="06_windows_vm.html">Optional: Windows Virtual Machines</a></li>
                
              
                
                  <li class="page"><a href="07_bare_metal.html">Optional: Bare Metal OpenShift Overview</a></li>
                
              
                
                  <li class="page"><a href="08_network_management.html">Optional: Network Management</a></li>
                
              
                
                  <li class="page"><a href="09_storage_management.html">Optional: Storage Management</a></li>
                
              
                
                  <li class="page"><a href="10_backup_restore.html">Optional: Backup and Restore</a></li>
                
              
                
                  <li class="page"><a href="11_metallb.html">Optional: Exposing apps using MetalLB</a></li>
                
              
                
                  <li class="page"><a href="12_service_route.html">Optional: Exposing apps using a Route</a></li>
                
              
            </ul>
          </li>
        </ul>
      </div>
      <div class="col-sm-9">
        <section class="page-content">
          <!-- Top Navigation -->
          <div class="btn-group btn-group-xs float-right">
            
              <button type="button" onclick="location.href='/workshop/02_migrate_vms';" class="btn btn-xs btn-transparent" aria-label="Prev">
                <span class="fas fa-arrow-left" aria-hidden="true"></span>
              </button>
            
            <button type="button" onclick="location.href='/workshop/';" class="btn btn-xs btn-transparent" aria-label="Home">
              <span class="fas fa-home" aria-hidden="true"></span>
            </button>
            
              <button type="button" onclick="location.href='/workshop/04_thanks';" class="btn btn-xs btn-transparent" aria-label="Next">
                <span class="fas fa-arrow-right" aria-hidden="true"></span>
              </button>
            
          </div>
          <!-- Title -->
          
            <h1 class="title">OpenShift Virtualization Basics</h1>
          
          <!-- Content -->
          <div id="toc" class="toc">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="03_ocpv_basics.html#_create_a_new_project">1. Create a new Project</a></li>
<li><a href="03_ocpv_basics.html#_create_a_linux_virtual_machine">2. Create a Linux virtual machine</a></li>
<li><a href="03_ocpv_basics.html#_access_the_virtual_machine_console">3. Access the virtual machine console</a></li>
<li><a href="03_ocpv_basics.html#_live_migrate_a_virtual_machine">4. Live migrate a virtual machine</a></li>
<li><a href="03_ocpv_basics.html#_optional_controlling_virtual_machine_state">5. [Optional] Controlling virtual machine state</a></li>
<li><a href="03_ocpv_basics.html#_optional_virtualization_overview_dashboard">6. [Optional] Virtualization Overview dashboard</a></li>
</ul>
</div>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>This lab will introduce you to the basics of creating and managing VMs in OpenShift Virtualization. You will see how the web console guides you through the whole process and how easy it is to review VM properties and do some basic customization. In the next lab you will customize the VMs a little bit further.</p>
</div>
<div class="paragraph">
<p>Among other things, this lab will show two methods for provisioning virtual machines, however, there are many different ways, and they are not limited to just what is shown here. All VM provisioning methods work with all supported operating systems.</p>
</div>
<div class="paragraph">
<p>Creating virtual machines is one of the most frequently accomplished tasks for a virtualization administrator. This section will walk through the process of creating a new virtual machine using a pre-created template. As the virtualization administrator, you have the ability to create your own templates that use guest operating system disks with your organization&#8217;s customizations, preferred VM sizing options, and additional customization options using cloud-init or sysprep.</p>
</div>
<div class="paragraph">
<p>In this lab, you become familiar with running virtual machines (VMs) on Red Hat<sup>&#174;</sup> OpenShift<sup>&#174;</sup> Container Platform. You create a new virtual machine based on a bootable operating system disk image provided in the default configuration of OpenShift Virtualization.</p>
</div>
<div class="ulist">
<div class="title">Goals</div>
<ul>
<li>
<p>Create a new virtual machine</p>
</li>
<li>
<p>Access the VM console</p>
</li>
<li>
<p>Gain experience using the VM console</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_create_a_new_project">1. Create a new Project</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Like other objects in OpenShift, Projects, which are an abstraction for Kubnernetes namespaces, are the boundaries for permissions and other aspects of using and manaing the resources. Creating a Project is an important first step for any deployment.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Browse to <strong>Virtualization</strong> &#8594; <strong>VirtualMachines</strong> using the left navigation menu:</p>
<div class="imageblock">
<div class="content">
<img src="images/Create_VM_PVC/01_Left_Menu.png" alt="Navigation Menu" width="136" height="266">
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>The <strong>Virtualization</strong> tab is available only when Red Hat OpenShift Virtualization is installed and properly configured.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Examine the <strong>VirtualMachines</strong> dashboard that appears. There are currently several VMs listed, but are not turned on:</p>
<div class="imageblock">
<div class="content">
<img src="images/Create_VM_PVC/51_vm_list.png" alt="51 vm list">
</div>
</div>
</li>
<li>
<p>Before creating a VM we need to create a new project. Virtual machines are deployed to a specific project, or namespace, where, by default, users without permission to the namespace cannot access, manage, or control them. Administrators can access all projects, and therefore view all virtual machines, however regular users must be given access to projects as needed.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Click <strong>Project: All Projects</strong> and then click <strong>Create Project</strong>.</p>
<div class="imageblock">
<div class="content">
<img src="images/Create_VM_PVC/50_create_new_project.png" alt="50 create new project">
</div>
</div>
</li>
<li>
<p>In the <strong>Name</strong> field, type <code>vmexamples</code> to name the project, then click <strong>Create</strong>.</p>
<div class="imageblock">
<div class="content">
<img src="images/Create_VM_PVC/03_Create_Project.png" alt="03 Create Project">
</div>
</div>
</li>
</ol>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_create_a_linux_virtual_machine">2. Create a Linux virtual machine</h2>
<div class="sectionbody">
<div class="olist arabic">
<ol class="arabic">
<li>
<p>From the Virtual Machines inventory, click <strong>Create VirtualMachine</strong></p>
<div class="imageblock">
<div class="content">
<img src="images/Create_VM_PVC/53_create_vm_button.png" alt="53 create vm button">
</div>
</div>
</li>
<li>
<p>The wizard will appear showing the available pre-defined VM templates.</p>
<div class="paragraph">
<p>Reviewing the list of available templates you’ll notice that some have a blue badge which indicates "Source available". These are templates which are using the automatically downloaded and stored template disks reviewed in the previous page. If you were deploying in your own environment, you have the option of preventing these from being created and/or removing those source disks, followed by creating and uploading custom disks for your organization.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/Create_VM_PVC/04_Create_VM_Templates.png" alt="04 Create VM Templates">
</div>
</div>
</li>
<li>
<p>Select the <strong>Fedora VM</strong> tile, and a dialog opens.</p>
<div class="imageblock">
<div class="content">
<img src="images/Create_VM_PVC/05_Create_VM_Quick.png" alt="05 Create VM Quick">
</div>
</div>
</li>
<li>
<p>Change the name to <code>fedora01</code> and press <strong>Quick create VirtualMachine</strong>:</p>
<div class="imageblock">
<div class="content">
<img src="images/Create_VM_PVC/05_Create_VM_Quick_Name.png" alt="05 Create VM Quick Name">
</div>
</div>
</li>
<li>
<p>After a few seconds, expect to see the VM is <code>Running</code>. During this time, the storage provider has cloned the template disk so that it can be used by the newly created virtual machine. The amount of time this takes will depend on the storage provider.</p>
<div class="imageblock">
<div class="content">
<img src="images/Create_VM_PVC/06_Fedora_Running.png" alt="06 Fedora Running">
</div>
</div>
</li>
<li>
<p>After the VM is created, examine the <strong>Events</strong> tab to see some details of the process. If there are any issues with the creation of the VM, they will show up on this tab as well.</p>
<div class="imageblock">
<div class="content">
<img src="images/Create_VM_PVC/09_Fedora_Events.png" alt="09 Fedora Events">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>A <em>DataVolume</em> is created. <em>DataVolumes</em> are used to manage the creation of a VM disk, abstracting the clone or import process onto OpenShift native storage during the virtual machine&#8217;s creation flow.</p>
</li>
<li>
<p>The <em>VM</em> is started.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Click the <strong>Details</strong> tab to obtain information related to the VM. Note that for this template, the default is 1 CPU and 2 GiB of memory. As the administrator, you can create templates that customize the default configuration of virtual machines.</p>
<div class="paragraph">
<p>The IP address of the virtual machine on the software-defined network (SDN) is also displayed here, along with information about the boot order, workload profile, the cluster node hosting the virtual machine, and more.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/Create_VM_PVC/10_Fedora_Details.png" alt="10 Fedora Details">
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_access_the_virtual_machine_console">3. Access the virtual machine console</h2>
<div class="sectionbody">
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Click the <strong>Console</strong> tab to access the VM&#8217;s console:</p>
<div class="imageblock">
<div class="content">
<img src="images/Create_VM_PVC/13_Fedora_Console.png" alt="13 Fedora Console">
</div>
</div>
</li>
<li>
<p>Click <strong>Guest login credentials</strong> to see the password generated for the <code>fedora</code> user. This is only visible when the VM has been customized, which is done by default with this template, using OpenShift Virtualization to set the password using cloud-init.</p>
<div class="imageblock">
<div class="content">
<img src="images/Create_VM_PVC/14_Fedora_Console_Show_Password.png" alt="14 Fedora Console Show Password">
</div>
</div>
</li>
<li>
<p>Log in to the VM using the <code>fedora</code> user and the indicated password.</p>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
You can click on <code>Paste</code> to paste the password after copying it.
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
If the <code>Paste</code> functionality is not working, take into consideration that the console input is using US keymap. One small trick is to write in the login the password to ensure you are writing the proper characters (specifically that the <code>-</code> character is correct).
</td>
</tr>
</table>
</div>
</li>
<li>
<p>After you log in, run the <code>ip a</code> command to display the interfaces and IP addresses:</p>
<div class="imageblock">
<div class="content">
<img src="images/Create_VM_PVC/15_Fedora_Network.png" alt="15 Fedora Network">
</div>
</div>
<div class="paragraph">
<p>Since this network adapter is connected to the SDN, the IP address assigned is an internal IP address used by the <em>KVM hypervisor</em> and is not an externally accessible IP. This IP will not change even if the VM is live migrated to a different node and the external IP where the VM is connected to the SDN changes.</p>
</div>
</li>
<li>
<p>Run <code>lsblk</code> to display the list of disks and their capacities and free space:</p>
<div class="imageblock">
<div class="content">
<img src="images/Create_VM_PVC/16_Fedora_Disk.png" alt="16 Fedora Disk">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>/dev/vda</code> is the disk created during the VM creation and is the size specified at creation time.</p>
</li>
<li>
<p><code>/dev/vdb</code> is used for <code>cloud-init</code> required data (for example, to configure the <code>fedora</code> user password). This disk can be removed after the VM has been created.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Examine the number of CPUs and amount of memory associated with the VM (which match the <code>flavor</code> specified during creation), using the <code>nproc</code> and <code>free -m</code> commands:</p>
<div class="imageblock">
<div class="content">
<img src="images/Create_VM_PVC/17_Fedora_CPU_Memory.png" alt="17 Fedora CPU Memory">
</div>
</div>
</li>
<li>
<p>To review the guest customization, mount the <code>cloud-init</code> disk:</p>
<div class="imageblock">
<div class="content">
<img src="images/Create_VM_PVC/21_Fedora01_Cloud_Init.png" alt="21 Fedora01 Cloud Init">
</div>
</div>
</li>
<li>
<p>The instance is running the guest agent to surface information about the guest OS to the hypervisor, along with coordinating tasks such as disk quiescing for snapshots.</p>
<div class="imageblock">
<div class="content">
<img src="images/Create_VM_PVC/19_Fedora_Agent.png" alt="19 Fedora Agent">
</div>
</div>
</li>
<li>
<p>Click the <strong>Overview</strong> tab to show the information obtained from the guest VM, such as the disk utilization, along with seeing resource utilization information:</p>
<div class="imageblock">
<div class="content">
<img src="images/Create_VM_PVC/19_Fedora_Agent_Details.png" alt="19 Fedora Agent Details">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Hostname</p>
</li>
<li>
<p>Operating system version and timezone information</p>
</li>
<li>
<p>Active users</p>
</li>
<li>
<p>Utilization: CPU, Memory, Storage and Network.</p>
</li>
</ul>
</div>
</li>
<li>
<p>You can navigate to the <strong>Metrics</strong> tab to obtain more information about the usage, including being able to specify the time range.</p>
<div class="imageblock">
<div class="content">
<img src="images/Create_VM_PVC/19_Fedora_Metrics.png" alt="19 Fedora Metrics">
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_live_migrate_a_virtual_machine">4. Live migrate a virtual machine</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In this section, we will migrate the VM from one OpenShift node to another without shutting down the VM. Live migration requires <code>ReadWriteMany</code> (RWX) storage so that the VM disks can be mounted on both the source and destination nodes at the same time. OpenShift Virtualization, unlike other virtualization solutions, does not use monolithic datastores mounted to each cluster member that hold many VM disks for many different VMs. Instead, each VM disk is stored in its own volume that is only mounted when and where it&#8217;s needed.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Navigate to the <strong>Details</strong> tab to see where the worker node is running:</p>
<div class="imageblock">
<div class="content">
<img src="images/Pods_Migration/17_VM_Info_Node.png" alt="17 VM Info Node">
</div>
</div>
</li>
<li>
<p>Using the menu <strong>Actions</strong>, press <strong>Migrate</strong></p>
<div class="imageblock">
<div class="content">
<img src="images/Pods_Migration/19_VM_Dialog_Migrate.png" alt="19 VM Dialog Migrate">
</div>
</div>
</li>
<li>
<p>After a few seconds, the VM will change the status to <code>Migrating</code>. A few seconds later, it will return to the <code>Running</code> status, but on a different node. The VM has been successfully live migrated!</p>
<div class="imageblock">
<div class="content">
<img src="images/Pods_Migration/21_Migrated.png" alt="21 Migrated">
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_optional_controlling_virtual_machine_state">5. [Optional] Controlling virtual machine state</h2>
<div class="sectionbody">
<div class="paragraph">
<p>As a user with permission to access virtual machines, you can stop, start, restart, pause, and unpause virtual machines from the web console.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In the left menu, go back to <strong>Virtualization</strong> &#8594; <strong>VirtualMachines</strong>:</p>
</li>
<li>
<p>Select the <em>Virtual Machine</em> <code>fedora02</code> from the list.</p>
</li>
<li>
<p>Press the top-right dropdown, <strong>Actions</strong>, to list the available
options:</p>
<div class="imageblock">
<div class="content">
<img src="images/Pods_Migration/30_VM_Actions_List.png" alt="30 VM Actions List">
</div>
</div>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p><strong>Stop</strong>: Starts a graceful shutdown of the <em>Virtual Machine</em>.</p>
</li>
<li>
<p><strong>Restart</strong>: This will send a signal to the operating system to reboot the <em>Virtual Machine</em>. Guest integrations are needed for this to work properly.</p>
</li>
<li>
<p><strong>Pause</strong>: The process is frozen without further access to CPU resources and I/O, but the memory used by the VM at the hypervisor level will stay allocated.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Press <strong>Stop</strong> and wait till the <em>Virtual Machine</em> is in state <code>Stopped</code>.</p>
<div class="imageblock">
<div class="content">
<img src="images/Pods_Migration/31_VM_Stopped.png" alt="31 VM Stopped">
</div>
</div>
</li>
<li>
<p>Clicking on <strong>Actions</strong>, the option <strong>Start</strong> appears, and the options <strong>Restart</strong> and <strong>Pause</strong> are greyed out.</p>
<div class="imageblock">
<div class="content">
<img src="images/Pods_Migration/32_VM_Actions_List_Stopped.png" alt="32 VM Actions List Stopped">
</div>
</div>
</li>
<li>
<p>Press <strong>Start</strong>, and wait for the <code>Running</code> status.</p>
</li>
<li>
<p>Using the <strong>Actions</strong> menu, press the <strong>Pause</strong> option. The <em>Virtual Machine</em> state will change to <code>Paused</code>.</p>
<div class="imageblock">
<div class="content">
<img src="images/Pods_Migration/33_VM_Actions_Paused.png" alt="33 VM Actions Paused">
</div>
</div>
</li>
<li>
<p>Unpause the <em>Virtual Machine</em> using <strong>Actions</strong> and the option <strong>Unpause</strong>.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_optional_virtualization_overview_dashboard">6. [Optional] Virtualization Overview dashboard</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The overview dashboard provides a cluster-level view of virtual machines and resources used, along with status information for the health of OpenShift Virtualization and virtual machines. It is a useful starting point for administrators who want a quick and high-level view of what&#8217;s happening with OpenShift Virtualization.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>From the left navigation menu, browse to <strong>Virtualization</strong> &#8594; <strong>Overview</strong> and select <strong>Project:</strong> &#8594; <strong>All projects</strong></p>
<div class="imageblock">
<div class="content">
<img src="images/Create_VM_PVC/create_overview_413.png" alt="create overview 413">
</div>
</div>
<div class="paragraph">
<p>This overview page provides the OpenShift Virtualization administrator a global overview of the virtual machines in the cluster. A normal user would only see the VMs in his/her own project.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Don&#8217;t forget to check out the <code>Getting started resources</code> panel and click the "View all quick starts" link there to access more information about OpenShift virtualization, including Quick Starts which provide many guided walkthroughs including how to create a VM and upload a custom boot source for your virtual machines.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/Create_VM_PVC/create_quickstarts413.png" alt="create quickstarts413">
</div>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Review the top consumers</p>
<div class="paragraph">
<p>Use the tabs across the top to view more about the virtualization resources in the cluster. For instance, the "Top consumers" tab shows the VMs which are "top consumers" of various resources, including CPU, memory, and storage. Note that in a newly created cluster, there are no consumers, so there is little to see in the beginning. You might also want to dig deeper into metrics by clicking on "View virtualization dashboard" link. That brings you to the KubeVirt Metrics Dashboard with more data and graphs.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
If you don&#8217;t see any resources here, no VMs have been started in your lab. Revisit this page after this segment to see the overview details.
</td>
</tr>
</table>
</div>
<div class="imageblock">
<div class="content">
<img src="images/Create_VM_PVC/create_overview_consumers413.png" alt="create overview consumers413">
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
          <!-- Bottom Navigation -->
          <div class="page-meta clearfix">
            
              
                <input type="button" class="btn btn-lg btn-primary float-right" onclick="location.href='/workshop/04_thanks';" value="Continue" />
              
            
          </div>
        </section>
      </div>
    </div>
  </div>
  <!-- Footer -->
  <footer class="footer">
  </footer>
  <!-- Javascript-->
  <script src="js/workshop.js"></script>
  <script src="js/workshop-asciidoc.js"></script>
</body>
</html>
